version: v1.0
name: Deployment Pipeline - Internal
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
  containers:
    - name: main
      image: 'registry.semaphoreci.com/android:29'
global_job_config:
  prologue:
    commands:
      - checkout
      - cache restore gradle-wrapper
      - cache restore gradle-cache
      - cache restore android-build
blocks:
  - name: Internal Deployment
    task:
      jobs:
        - name: Deploy to Play Store - Internal Track
          commands:
            - echo "deploy to internal track"
promotions:
  - name: Beta Deploy
    pipeline_file: deploy-beta.yml
    auto_promote:
      when: result = 'passed' AND branch = 'main'
