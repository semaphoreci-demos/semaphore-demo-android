version: v1.0
name: Main Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

auto_cancel:
  running:
    when: "branch != 'master' AND pull_request =~ '.*'"

global_job_config:
  prologue:
    commands:
      - checkout

blocks:
  - name: Verification and Deployment
    task:
      jobs:
        - name: Starting Build
          commands:
            - echo 'Build Started'

promotions:
  - name: Verification Pipeline
    pipeline_file: verification-pipeline.yml
    auto_promote:
      when: "pull_request =~ '.*'"
  - name: Deploy Pipeline
    pipeline_file: deploy-pipeline.yml
    auto_promote:
      when: "branch = 'master'"
